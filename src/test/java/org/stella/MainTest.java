package org.stella;

import org.junit.jupiter.api.*;
import org.junit.jupiter.params.*;
import org.junit.jupiter.params.provider.*;

import static org.junit.jupiter.api.Assertions.*;
import java.io.*;

class MainTest {


    @ParameterizedTest(name = "{index} Typechecking well-typed program {0}")
    @ValueSource(strings = {
            "tests/ascriptions/well-typed/good-anonymous-function.stella",
            "tests/ascriptions/well-typed/good-pair.stella",
            "tests/core/well-typed/abstract-function.stella",
            "tests/core/well-typed/added-test-1.stella",
            "tests/core/well-typed/added-test-2.stella",
            "tests/core/well-typed/apply-increase.stella",
            "tests/core/well-typed/applying-actual-function-3.stella",
            "tests/core/well-typed/bool-to-nat.stella",
            "tests/core/well-typed/cubes.stella",
            "tests/core/well-typed/double-application.stella",
            "tests/core/well-typed/extra-tests/multiparameter-functions/test-1.stella",
            "tests/core/well-typed/extra-tests/multiparameter-functions/test-2.stella",
            "tests/core/well-typed/extra-tests/natural-literals/test-1.stella",
            "tests/core/well-typed/extra-tests/natural-literals/test-2.stella",
            "tests/core/well-typed/extra-tests/nested-function-declarations/test-1.stella",
            "tests/core/well-typed/extra-tests/nested-function-declarations/test-2.stella",
            "tests/core/well-typed/extra-tests/nested-function-declarations/test-3.stella",
            "tests/core/well-typed/extra-tests/nullary-functions/test-1.stella",
            "tests/core/well-typed/extra-tests/nullary-functions/test-2.stella",
            "tests/core/well-typed/factorial.stella",
            "tests/core/well-typed/good-if-2.stella",
            "tests/core/well-typed/good-if.stella",
            "tests/core/well-typed/good-succ-1.stella",
            "tests/core/well-typed/good-succ-2.stella",
            "tests/core/well-typed/higher-order-1.stella",
            "tests/core/well-typed/higher-order-2.stella",
            "tests/core/well-typed/if-funcs.stella",
            "tests/core/well-typed/increment-triple.stella",
            "tests/core/well-typed/increment_twice.stella",
            "tests/core/well-typed/inner-if.stella",
            "tests/core/well-typed/logical-operators.stella",
            "tests/core/well-typed/many-if.stella",
            "tests/core/well-typed/my-good-if.stella",
            "tests/core/well-typed/my-good-succ.stella",
            "tests/core/well-typed/my-well-typed-1.stella",
            "tests/core/well-typed/my-well-typed-2.stella",
            "tests/core/well-typed/nat-to-bool.stella",
            "tests/core/well-typed/negate.stella",
            "tests/core/well-typed/nested.stella",
            "tests/core/well-typed/shadowed-variable-2.stella",
            "tests/core/well-typed/simple-if.stella",
            "tests/core/well-typed/simple-succ.stella",
            "tests/core/well-typed/simple-types.stella",
            "tests/core/well-typed/squares.stella",
            "tests/core/well-typed/succ-with-func.stella",
            "tests/exceptions/well-typed/panic-1.stella",
            "tests/exceptions/well-typed/panic-2.stella",
            "tests/exceptions/well-typed/panic-3.stella",
            "tests/exceptions/well-typed/throw-1.stella",
            "tests/exceptions/well-typed/throw-2.stella",
            "tests/exceptions/well-typed/try-catch-1.stella",
            "tests/exceptions/well-typed/try-catch-2.stella",
            "tests/exceptions/well-typed/try-with-1.stella",
            "tests/exceptions/well-typed/try-with-2.stella",
            "tests/let-bindings/well-typed/let-1.stella",
            "tests/let-bindings/well-typed/let-2.stella",
            "tests/let-bindings/well-typed/let-3.stella",
            "tests/let-bindings/well-typed/let-4.stella",
            "tests/letrecs/well-typed/letrec.stella",
            "tests/lists/well-typed/empty-list.stella",
            "tests/lists/well-typed/lists-1.stella",
            "tests/lists/well-typed/lists-2.stella",
            "tests/lists/well-typed/lists-3.stella",
            "tests/pairs/well-typed/pairs-1.stella",
            "tests/pairs/well-typed/pairs-2.stella",
            "tests/pairs/well-typed/pairs-3.stella",
            "tests/pairs/well-typed/pairs-4.stella",
            "tests/pairs/well-typed/pairs-5.stella",
            "tests/pairs/well-typed/pairs-6.stella",
            "tests/records/well-typed/records-1.stella",
            "tests/records/well-typed/records-2.stella",
            "tests/records/well-typed/records-4.stella",
            "tests/records/well-typed/records-5.stella",
            "tests/records/well-typed/records-6.stella",
            "tests/records/well-typed/records-7.stella",
            "tests/records/well-typed/records-8.stella",
            "tests/recursions/well-typed/fix-2.stella",
            "tests/recursions/well-typed/fix.stella",
            "tests/recursions/well-typed/general-recursion.stella",
            "tests/references/well-typed/refs-1.stella",
            "tests/references/well-typed/refs-2.stella",
            "tests/references/well-typed/refs-3.stella",
            "tests/references/well-typed/refs-4.stella",
            "tests/sum-types/well-typed/sum-types-1.stella",
            "tests/sum-types/well-typed/sum-types-2.stella",
            "tests/sum-types/well-typed/sum-types-3.stella",
            "tests/tuples/well-typed/tuples-1.stella",
            "tests/typealiases/well-typed/double-alias.stella",
            "tests/typealiases/well-typed/simple-alias.stella",
            "tests/units/well-typed/ignore.stella",
            "tests/units/well-typed/test-1.stella",
            "tests/units/well-typed/test-2.stella",
            "tests/variants/nullary/well-typed/nullary-1.stella",
            "tests/variants/nullary/well-typed/nullary-2.stella",
            "tests/variants/nullary/well-typed/nullary-3.stella",
            "tests/variants/nullary/well-typed/nullary-4.stella",
            "tests/variants/well-typed/variants-1.stella",
            "tests/variants/well-typed/variants-2.stella",
            "tests/variants/well-typed/variants-3.stella",
    })
    void testWellTyped(String filepath) throws Exception {
        String[] args = new String[0];
        final InputStream original = System.in;
        final FileInputStream fips = new FileInputStream(filepath);
        System.setIn(fips);
        Assertions.assertDoesNotThrow(() -> Main.main(args));
        System.setIn(original);
    }

    @ParameterizedTest(name = "{index} Typechecking ill-typed program {0}")
    @ValueSource(strings = {
            "tests/ascriptions/ill-typed/bad-anonymous-function.stella",
            "tests/ascriptions/ill-typed/bad-pair.stella",
            "tests/core/ill-typed/extra-tests/incorrect_arity_of_main/my-test-2.stella",
            "tests/core/ill-typed/extra-tests/incorrect_arity_of_main/my-test.stella",
            "tests/core/ill-typed/extra-tests/incorrect_number_of_arguments/test-1.stella",
            "tests/core/ill-typed/extra-tests/incorrect_number_of_arguments/test-2.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-add-1.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-cmp-1.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-cmp-2.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-cmp-3.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-cmp-4.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-cmp-5.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-cmp-6.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-logic-and-1.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-logic-or-1.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/bad-multiply-1.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/test-1.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/test-2.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/test-3.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/test-4.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/test-5.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/test-6.stella",
            "tests/core/ill-typed/extra-tests/multiparameter-functions/test-7.stella",
            "tests/core/ill-typed/extra-tests/natural-literals/bad-factorial-1.stella",
            "tests/core/ill-typed/extra-tests/natural-literals/bad-factorial-2.stella",
            "tests/core/ill-typed/extra-tests/nested-function-declarations/test-1.stella",
            "tests/core/ill-typed/extra-tests/nested-function-declarations/test-2.stella",
            "tests/core/ill-typed/extra-tests/nested-function-declarations/test-3.stella",
            "tests/core/ill-typed/extra-tests/nullary-functions/test-1.stella",
            "tests/core/ill-typed/extra-tests/nullary-functions/test-2.stella",
            "tests/core/ill-typed/extra-tests/nullary-functions/test-3.stella",
            "tests/core/ill-typed/extra-tests/nullary-functions/test-4.stella",
            "tests/core/ill-typed/extra-tests/nullary-functions/test-5.stella",
            "tests/core/ill-typed/extra-tests/unexpected_number_of_parameters_in_lambda/test-1.stella",
            "tests/core/ill-typed/extra-tests/unexpected_number_of_parameters_in_lambda/test-2.stella",
            "tests/core/ill-typed/extra-tests/unexpected_number_of_parameters_in_lambda/test-3.stella",
            "tests/core/ill-typed/extra-tests/unexpected_number_of_parameters_in_lambda/test-4.stella",
            "tests/core/ill-typed/missing_main/missing-main-1.stella",
            "tests/core/ill-typed/missing_main/missing-main-2.stella",
            "tests/core/ill-typed/not-a-function/applying-non-function-1.stella",
            "tests/core/ill-typed/not-a-function/applying-non-function-2.stella",
            "tests/core/ill-typed/not-a-function/applying-non-function-3.stella",
            "tests/core/ill-typed/not-a-function/if-funcs.stella",
            "tests/core/ill-typed/not-a-function/my-factorial.stella",
            "tests/core/ill-typed/not-a-function/not-a-function-1.stella",
            "tests/core/ill-typed/not-a-function/shadowed-variable-1.stella",
            "tests/core/ill-typed/not-a-function/shadowed-variable-2.stella",
            "tests/core/ill-typed/undefined-variable/bad-if-and-undefined-variable-1.stella",
            "tests/core/ill-typed/undefined-variable/undef-var-1.stella",
            "tests/core/ill-typed/undefined-variable/undefined-variable-1.stella",
            "tests/core/ill-typed/undefined-variable/undefined-variable-2.stella",
            "tests/core/ill-typed/undefined-variable/undefined-variable-3.stella",
            "tests/core/ill-typed/unexpected-lambda/bad-function-call.stella",
            "tests/core/ill-typed/unexpected-lambda/bad-if-4.stella",
            "tests/core/ill-typed/unexpected-lambda/bad-squares-1.stella",
            "tests/core/ill-typed/unexpected-lambda/bad-succ-2.stella",
            "tests/core/ill-typed/unexpected-lambda/if-funcs.stella",
            "tests/core/ill-typed/unexpected-lambda/my-ill-typed-2.stella",
            "tests/core/ill-typed/unexpected-lambda/unexpected-lambda-1.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/added-test-2.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/application-param-type.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/argument-type-mismatch-1.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-abstraction.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-factorial.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-higher-order-1.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-if-1.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-if-2.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-if-3.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-iszero.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-nat-2.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-nat-rec-1.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-nat-rec-2.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-return-type.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-squares-2.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-succ-1.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/bad-succ-3.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/function-mismatch.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/if-funcs.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/my-ill-test-2.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/my-ill-typed-1.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/my-mismatch.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/nat__rec-parameters.stella",
            "tests/core/ill-typed/unexpected-type-for-expression/unexpected-type-for-expression-1.stella",
            "tests/core/ill-typed/unexpected-type-for-parameter/added-test-1.stella",
            "tests/core/ill-typed/unexpected-type-for-parameter/argument-type-mismatch-2.stella",
            "tests/core/ill-typed/unexpected-type-for-parameter/argument-type-mismatch-3.stella",
            "tests/core/ill-typed/unexpected-type-for-parameter/bad-nat-1.stella",
            "tests/core/ill-typed/unexpected-type-for-parameter/if-funcs.stella",
            "tests/core/ill-typed/unexpected-type-for-parameter/invalid-nat.stella",
            "tests/core/ill-typed/unexpected-type-for-parameter/invalid-not_.stella",
            "tests/core/ill-typed/unexpected-type-for-parameter/unexpected-type-for-parameter-1.stella",
            "tests/exceptions/ill-typed/ambiguous-panic-type-1.stella",
            "tests/exceptions/ill-typed/ambiguous-panic-type-2.stella",
            "tests/exceptions/ill-typed/ambiguous-panic-type-3.stella",
            "tests/exceptions/ill-typed/ambiguous-panic-type-4.stella",
            "tests/exceptions/ill-typed/ambiguous-throw-type-1.stella",
            "tests/exceptions/ill-typed/ambiguous-throw-type-2.stella",
            "tests/exceptions/ill-typed/ambiguous-throw-type-3.stella",
            "tests/exceptions/ill-typed/exception-type-not-declared-throw.stella",
            "tests/exceptions/ill-typed/exception-type-not-declared-try-catch.stella",
            "tests/exceptions/ill-typed/exception-type-not-declared-try-with.stella",
            "tests/exceptions/ill-typed/unexpected-type-for-expression-throw-1.stella",
            "tests/exceptions/ill-typed/unexpected-type-for-expression-throw-2.stella",
            "tests/exceptions/ill-typed/unexpected-type-for-expression-try-catch-1.stella",
            "tests/exceptions/ill-typed/unexpected-type-for-expression-try-catch-2.stella",
            "tests/exceptions/ill-typed/unexpected-type-for-expression-try-with-1.stella",
            "tests/exceptions/ill-typed/unexpected-type-for-expression-try-with-2.stella",
            "tests/let-bindings/ill-typed/bad-let-1.stella",
            "tests/let-bindings/ill-typed/bad-let-2.stella",
            "tests/let-bindings/ill-typed/bad-let-3.stella",
            "tests/let-bindings/ill-typed/bad-let-4.stella",
            "tests/let-bindings/ill-typed/bad-let-5.stella",
            "tests/let-bindings/ill-typed/bad-let-6.stella",
            "tests/let-bindings/ill-typed/bad-let-7.stella",
            "tests/letrecs/ill-typed/bad-letrec.stella",
            "tests/lists/ill-typed/ambiguous-list-type-isempty.stella",
            "tests/lists/ill-typed/bad-lists-1.stella",
            "tests/lists/ill-typed/bad-lists-2.stella",
            "tests/lists/ill-typed/bad-variants-1.stella",
            "tests/lists/ill-typed/not-a-list-head.stella",
            "tests/lists/ill-typed/not-a-list-isempty.stella",
            "tests/lists/ill-typed/not-a-list-tail.stella",
            "tests/lists/ill-typed/unexepected-list-unit.stella",
            "tests/lists/ill-typed/unexpected-empty-list.stella",
            "tests/lists/ill-typed/unexpected-list-if-condition.stella",
            "tests/lists/ill-typed/unexpected-list-let-bindings.stella",
            "tests/lists/ill-typed/unexpected-list-natrec.stella",
            "tests/lists/ill-typed/unexpected-list-pair.stella",
            "tests/pairs/ill-typed/bad-pairs-1.stella",
            "tests/pairs/ill-typed/bad-pairs-10.stella",
            "tests/pairs/ill-typed/bad-pairs-11.stella",
            "tests/pairs/ill-typed/bad-pairs-12.stella",
            "tests/pairs/ill-typed/bad-pairs-13.stella",
            "tests/pairs/ill-typed/bad-pairs-14.stella",
            "tests/pairs/ill-typed/bad-pairs-15.stella",
            "tests/pairs/ill-typed/bad-pairs-16.stella",
            "tests/pairs/ill-typed/bad-pairs-17.stella",
            "tests/pairs/ill-typed/bad-pairs-2.stella",
            "tests/pairs/ill-typed/bad-pairs-3.stella",
            "tests/pairs/ill-typed/bad-pairs-4.stella",
            "tests/pairs/ill-typed/bad-pairs-5.stella",
            "tests/pairs/ill-typed/bad-pairs-6.stella",
            "tests/pairs/ill-typed/bad-pairs-7.stella",
            "tests/pairs/ill-typed/bad-pairs-8.stella",
            "tests/pairs/ill-typed/bad-pairs-9.stella",
            "tests/records/ill-typed/bad-records-1.stella",
            "tests/records/ill-typed/bad-records-10.stella",
            "tests/records/ill-typed/bad-records-11.stella",
            "tests/records/ill-typed/bad-records-12.stella",
            "tests/records/ill-typed/bad-records-13.stella",
            "tests/records/ill-typed/bad-records-14.stella",
            "tests/records/ill-typed/bad-records-15.stella",
            "tests/records/ill-typed/bad-records-16.stella",
            "tests/records/ill-typed/bad-records-17.stella",
            "tests/records/ill-typed/bad-records-18.stella",
            "tests/records/ill-typed/bad-records-19.stella",
            "tests/records/ill-typed/bad-records-2.stella",
            "tests/records/ill-typed/bad-records-20.stella",
            "tests/records/ill-typed/bad-records-21.stella",
            "tests/records/ill-typed/bad-records-23.stella",
            "tests/records/ill-typed/bad-records-3.stella",
            "tests/records/ill-typed/bad-records-4.stella",
            "tests/records/ill-typed/bad-records-5.stella",
            "tests/records/ill-typed/bad-records-6.stella",
            "tests/records/ill-typed/bad-records-7.stella",
            "tests/records/ill-typed/bad-records-8.stella",
            "tests/records/ill-typed/bad-records-9.stella",
            "tests/records/ill-typed/records-3.stella",
            "tests/recursions/ill-typed/divergent-param-and-return-types.stella",
            "tests/recursions/ill-typed/fix-2.stella",
            "tests/recursions/ill-typed/fix.stella",
            "tests/recursions/ill-typed/general-recursion.stella",
            "tests/recursions/ill-typed/not-a-function.stella",
            "tests/recursions/ill-typed/two-parameters.stella",
            "tests/references/ill-typed/ambiguous-reference-type-1.stella",
            "tests/references/ill-typed/not-a-reference-1.stella",
            "tests/references/ill-typed/not-a-reference-2.stella",
            "tests/references/ill-typed/not-a-reference-3.stella",
            "tests/references/ill-typed/not-a-reference-4.stella",
            "tests/references/ill-typed/not-a-reference-5.stella",
            "tests/references/ill-typed/unexpected-memory-address-1.stella",
            "tests/references/ill-typed/unexpected-memory-address-2.stella",
            "tests/references/ill-typed/unexpected-memory-address-3.stella",
            "tests/references/ill-typed/unexpected-memory-address-4.stella",
            "tests/references/ill-typed/unexpected-type-for-expression-1.stella",
            "tests/references/ill-typed/unexpected-type-for-expression-2.stella",
            "tests/references/ill-typed/unexpected-type-for-expression-3.stella",
            "tests/references/ill-typed/unexpected-type-for-expression-4.stella",
            "tests/sum-types/ill-typed/bad-sum-types-1.stella",
            "tests/sum-types/ill-typed/bad-sum-types-10.stella",
            "tests/sum-types/ill-typed/bad-sum-types-11.stella",
            "tests/sum-types/ill-typed/bad-sum-types-12.stella",
            "tests/sum-types/ill-typed/bad-sum-types-13.stella",
            "tests/sum-types/ill-typed/bad-sum-types-2.stella",
            "tests/sum-types/ill-typed/bad-sum-types-3.stella",
            "tests/sum-types/ill-typed/bad-sum-types-4.stella",
            "tests/sum-types/ill-typed/bad-sum-types-5.stella",
            "tests/sum-types/ill-typed/bad-sum-types-6.stella",
            "tests/sum-types/ill-typed/bad-sum-types-7.stella",
            "tests/sum-types/ill-typed/bad-sum-types-8.stella",
            "tests/sum-types/ill-typed/bad-sum-types-9.stella",
            "tests/tuples/ill-typed/bad-tuples-1.stella",
            "tests/tuples/ill-typed/bad-tuples-2.stella",
            "tests/tuples/ill-typed/bad-tuples-3.stella",
            "tests/typealiases/ill-typed/wrong-double-alias.stella",
            "tests/typealiases/ill-typed/wrong-simple-alias.stella",
            "tests/units/ill-typed/bad_ignore.stella",
            "tests/units/ill-typed/test-1.stella",
            "tests/units/ill-typed/test-2.stella",
            "tests/units/ill-typed/test-3.stella",
            "tests/variants/ill-typed/ambiguous-variant-type-1.stella",
            "tests/variants/ill-typed/ambiguous-variant-type-2.stella",
            "tests/variants/ill-typed/ambiguous-variant-type-3.stella",
            "tests/variants/ill-typed/non-exaustive-match-patterns-1.stella",
            "tests/variants/ill-typed/undefined-variable-1.stella",
            "tests/variants/ill-typed/unexpected-pattern-match-1.stella",
            "tests/variants/ill-typed/unexpected-pattern-match-2.stella",
            "tests/variants/ill-typed/unexpected-type-of-expression-1.stella",
            "tests/variants/ill-typed/unexpected-type-of-expression-2.stella",
            "tests/variants/ill-typed/unexpected-type-of-expression-3.stella",
            "tests/variants/ill-typed/unexpected-type-of-expression-4.stella",
            "tests/variants/ill-typed/unexpected-type-of-expression-with-alternative-errors.stella",
            "tests/variants/ill-typed/unexpected-variable-label-1.stella",
            "tests/variants/ill-typed/unexpected-variable-label-2.stella",
            "tests/variants/ill-typed/unexpected-variant-1.stella",
            "tests/variants/ill-typed/unexpected-variant-2.stella",
            "tests/variants/ill-typed/unexpected-variant-3.stella",
            "tests/variants/nullary/ill-typed/missing_data_for_label.stella",
            "tests/variants/nullary/ill-typed/non_nullary_var_pattern.stella",
            "tests/variants/nullary/ill-typed/nullary_var_pattern.stella",
            "tests/variants/nullary/ill-typed/unexpecteed_data_nullary.stella",
    })
    void testIllTyped(String filepath) throws Exception {
        String[] args = new String[0];
        final FileInputStream fips = new FileInputStream(filepath);
        System.setIn(fips);

        Exception exception = assertThrows(Exception.class, () -> Main.main(args), "Expected the type checker to fail!");
        System.out.println("Type Error: " + exception.getMessage());
    }
}
